<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Title</title>


  <link rel="stylesheet" href="./style.css">

  <style>
    textarea {
      font-size: 16px;
      color: #fff;
      background: rgba(0, 0, 0, .1);
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
      height: 30vh;
      resize: none;
    }

    .login-box {
      width: 50vw;
    }

    @media screen and (max-width: 800px) {
      .login-box {
        width: 90vw;
      }
    }


    #output {
      border: none;

    }
  </style>
</head>

<body>
  <div id="your-element-id" class="background-image">
    <div class="login-box">
      <h2 id="title">Chat Room</h2>
      <form>


        <textarea name="myText" id="output"></textarea>

        <br><br><br><br>
        <div class="user-box">
          <input type="text" name="text" required="" id="content">
          <label>Send a message</label>
        </div>



        <a href="#" class="btn">
          <span></span>
          <span></span>
          <span></span>
          <span></span>
          Submit
        </a>
      </form>
    </div>
  </div>
</body>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  //  防止圖片閃爍
  $(document).ready(function () {
    var backgroundImage = new Image();
    backgroundImage.src = "./img/backgroundimg.jpg";

    $(backgroundImage).on("load", function () {
      $("#your-element-id").css("filter", "none");
      $("#your-element-id").css("opacity", "1");
    });

    // 歡迎光臨
    let user = JSON.parse(sessionStorage.getItem("user"));
    let message = `Welcome, ${user.username}! Please enter your text to start asking questions.`;

    let index = 0;

    function displayCharacters() {
      if (index < message.length) {
        let substring = message.substring(0, index + 1);
        document.getElementById("output").innerHTML = substring;
        index++;
        setTimeout(displayCharacters, 100); // 0.2秒後再次呼叫函數
      }
    }

    displayCharacters();
  });

  $("#content").on("keypress", function (event) {
    if (event.which === 13) { // Enter 键的键码是 13
      event.preventDefault(); // 阻止默认的 Enter 键行为，如提交表单
      // 在这里执行你想要的操作
      console.log("Enter 键被按下");
      // 可以调用你的函数或执行其他操作
      $(".btn").click();
    }
  });

  $(".btn").on("click", function (e) {
    e.preventDefault();
    document.getElementById("output").innerHTML = "";
    message();

  });


  message = function () {
    let content = $("#content").val();
    console.log(content);

    $.ajax({
      url: "/content",
      method: "POST",
      data: { content: content },
      success: function (response) {
        $("#content").val("");
        console.log(response);
      }
    })
  }


  const sseSource = new EventSource(`/sse`);
  sseSource.addEventListener("message", function (event) {
    console.log(event);

    if (event.data !== null) {
      let processedData = event.data.replace(/\\n/g, '\n');
      processedData = processedData.replace("\\s", " ");
      // let value = event.data.replace(/\\n/g, "\n");
      document.getElementById("output").innerHTML += processedData;
      // console.log(value)
    }
  });


</script>

</html>